var canvaspreffix="mapbox-canvas";var maps={};jQuery(window).load(function(){var b=false;L.mapbox.accessToken=WPMapbox.mapaccesstoken;L.mapbox.config.FORCE_HTTPS=true;L.mapbox.config.HTTPS_URL="https://api.tiles.mapbox.com/v4";jQuery(".mapbox-map").each(function(e){var c=jQuery(this);var d=c.data("mapinternid");maps[d]={};maps[d].accesstoken=WPMapbox.mapaccesstoken;maps[d].mapid=c.data("mapid");maps[d].mapboxid=c.data("mapboxid");maps[d].mapsuffix=c.data("mapsuffix");maps[d].mapinternid=convertToSafeId(c.data("mapinternid"));$canvas='<div class="'+canvaspreffix+'" id="'+canvaspreffix+"-"+maps[d].mapinternid+'"></div>';c.prepend($canvas);maps[d].mapcanvas=c.children("#"+canvaspreffix+"-"+maps[d].mapinternid);maps[d].pixelwidth=maps[d].mapcanvas.outerWidth();maps[d].pixelheight=maps[d].mapcanvas.outerHeight();maps[d].mapstaticmap=c.data("mapstaticmap");maps[d].mapstaticmapformat=WPMapbox.mapstaticmapformat;maps[d].mapstaticmapformatretina=WPMapbox.mapstaticmapformatretina;maps[d].mapstaticmapretinasuffix=WPMapbox.mapstaticmapretinasuffix;maps[d].mappadding=c.data("mappadding");maps[d].mappaddingtlx=c.data("mappaddingtlx");maps[d].mappaddingtly=c.data("mappaddingtly");maps[d].mappaddingbrx=c.data("mappaddingbrx");maps[d].mappaddingbry=c.data("mappaddingbry");maps[d].mapcontinuousworld=WPMapbox.mapcontinuousworld;maps[d].mapattributioncontrol=WPMapbox.mapattributioncontrol;maps[d].mapdisabletouchzoom=WPMapbox.mapdisabletouchzoom;maps[d].mapdisabledrag=WPMapbox.mapdisabledrag;maps[d].mapclustermode=WPMapbox.mapclustermode;maps[d].mapclustercolor=WPMapbox.mapclustercolor;maps[d].mapcenterlat=c.data("mapcenterlat");maps[d].mapcenterlng=c.data("mapcenterlng");maps[d].mapmaxzoom=c.data("mapmaxzoom");maps[d].mapminzoom=c.data("mapminzoom");maps[d].mapzoom=c.data("mapzoom");maps[d].mapmaxbounds=null;maps[d].mapmaxboundsswlat=c.data("mapmaxboundsswlat");maps[d].mapmaxboundsswlng=c.data("mapmaxboundsswlng");maps[d].mapmaxboundsnelat=c.data("mapmaxboundsnelat");maps[d].mapmaxboundsnelng=c.data("mapmaxboundsnelng");if((maps[d].mapmaxboundsswlat>=-90)&&(maps[d].mapmaxboundsswlat<=90)&&(maps[d].mapmaxboundsswlng>=-180)&&(maps[d].mapmaxboundsswlng<=180)&&(maps[d].mapmaxboundsnelat>=-90)&&(maps[d].mapmaxboundsnelat<=90)&&(maps[d].mapmaxboundsnelng>=-90)&&(maps[d].mapmaxboundsnelng<=180)&&((maps[d].mapmaxBoundsswlat!==0)&&(maps[d].mapmaxboundsswlng!==0)&&(maps[d].mapmaxboundsnelat!==0)&&(maps[d].mapmaxboundsnelng!=-0))){maps[d].mapmaxbounds=L.latLngBounds(L.latLng(maps[d].mapmaxboundsswlat,maps[d].mapmaxboundsswlng),L.latLng(maps[d].mapmaxboundsnelat,maps[d].mapmaxboundsnelng))}maps[d].mapsharecontrol=c.data("mapsharecontrol");maps[d].mapsharecontrolposition=c.data("mapsharecontrolposition");maps[d].mapfullscreencontrol=c.data("mapfullscreencontrol");maps[d].mapfullscreencontrolposition=c.data("mapfullscreencontrolposition");maps[d].mapzoomcontrol=c.data("mapzoomcontrol");maps[d].mapzoomcontrolposition=c.data("mapzoomcontrolposition");maps[d].mapgeocodercontrol=c.data("mapgeocodercontrol");maps[d].mapgeocodercontrolautoc=c.data("mapgeocodercontrolautoc");maps[d].mapgeocodercontrolposition=c.data("mapgeocodercontrolposition");maps[d].mapgeocoderradiuskm=c.data("mapgeocoderradiuskm");maps[d].maplegendbackgroundcolor=c.data("maplegendbackgroundcolor");maps[d].maplegendposition=c.data("maplegendposition");maps[d].maplayerscontrolposition=c.data("maplayerscontrolposition");maps[d].mapuselocation=c.data("mapuselocation");if(maps[d].mapuselocation){b=true}maps[d].maplocatehighaccuracy=WPMapbox.maplocatehighaccuracy;maps[d].mapdisplaylocation=WPMapbox.mapdisplaylocation;maps[d].maplocationmarkersize=WPMapbox.maplocationmarkersize;maps[d].maplocationmarkersymbol=WPMapbox.maplocationmarkersymbol;maps[d].maplocationmarkercolor=WPMapbox.maplocationmarkercolor;maps[d].mapcenteronlocation=c.data("mapcenteronlocation");maps[d].mapgeolocatemaxradiuskm=convertStrToInt(c.data("mapgeolocatemaxradiuskm"));maps[d].geolocationisinradius=false;maps[d].mapfittomarkers=c.data("mapfittomarkers");maps[d].mapmaxradiuskm=c.data("mapmaxradiuskm");maps[d].mapmarkersbounds=null;maps[d].mapcenteronmarkerclick=WPMapbox.mapcenteronmarkerclick;maps[d].maplayersids=c.data("maplayersids");maps[d].maplayersurls=c.data("maplayersurls");maps[d].mapwmslayers=c.data("mapwmslayers");maps[d].mapwmslayersdefault=c.data("mapwmslayersdefault");maps[d].mapfeaturesids=c.data("mapfeaturesids");maps[d].mapfeaturesurls=c.data("mapfeaturesurls");maps[d].mapfeaturesurlstimeout=c.data("mapfeaturesurlstimeout");maps[d].mapfeaturescode=c.data("mapfeaturescode");maps[d].mapcirclearoundlocation=c.data("mapcirclearoundlocation")});prepareMap()});function prepareMap(){jQuery.each(maps,function(b,c){if(!c.mapstaticmap){prepareDynamicMap(c)}else{prepareStaticMap(c)}})}function prepareDynamicMap(c){if(c.mapstaticmap){return}var b={};if(!c.mapcontinuousworld){b.tileLayer={noWrap:true}}b.maxBounds=c.mapmaxbounds;if(c.mapminzoom>0){b.minZoom=c.mapminzoom}if(c.mapmaxzoom>0){b.maxZoom=c.mapmaxzoom}b.attributioncontrol=c.mapattributioncontrol;c.lmap=L.mapbox.map(canvaspreffix+"-"+c.mapinternid,c.mapboxid,b);addLayers(c);c.lmap.featureLayer.on("ready",function(l){var n=l.target._geojson.id;var k=n;var f=jQuery(l.target._map._container);if(f.length){var m=f.attr("id");k=m.substr(canvaspreffix.length+1)}var g=maps[k];var j=this;addFeatures(g);g.markers=[];g.lmap.eachLayer(function(e){if(e instanceof L.Marker){e.isinbounds=true;g.markers.push(e)}});if(g.markers.length>0){var h=new L.featureGroup(g.markers);g.mapmarkersbounds=h.getBounds()}addClusterMarkers(g,l);g.geolocationLatLng=null;if(c.mapuselocation){getLocation()}else{updateMap(g)}});if(c.mapcenteronmarkerclick){c.lmap.featureLayer.on("click",function(f){c.lmap.panTo(f.layer.getLatLng())})}if((c.mapzoomcontrol)&&(!c.mapstaticmap)){addZoomControl(c)}if(c.mapfullscreencontrol){addFullscreenControl(c)}if(c.mapsharecontrol){addShareControl(c)}if(c.mapgeocodercontrol){addGeocoderControl(c)}var d=jQuery("#mapboxadv-legend-content-"+c.mapinternid+"-base");if(d.length){addLegendControl(c,d,"base")}if(c.mapdisabledrag){c.lmap.dragging.disable()}if(c.mapdisabletouchzoom){c.lmap.touchZoom.disable();c.lmap.doubleClickZoom.disable();c.lmap.scrollWheelZoom.disable();c.lmap.boxZoom.disable()}}function prepareStaticMap(b){if(!b.mapstaticmap){return}updateMap(b)}function addClusterMarkers(d,c){if(d.mapclustermode=="none"){return false}var b=null;if(d.mapclustermode=="classic"){b=new L.MarkerClusterGroup()}else{b=new L.MarkerClusterGroup({iconCreateFunction:function(e){return L.mapbox.marker.icon({"marker-symbol":e.getChildCount(),"marker-color":d.mapclustercolor,})}})}c.target.eachLayer(function(e){b.addLayer(e);d.lmap.removeLayer(e)});d.lmap.addLayer(b);return true}function addShareControl(b){share=new L.mapbox.shareControl(null);if(b.mapsharecontrolposition!="default"){share.setPosition(b.mapsharecontrolposition)}share.addTo(b.lmap)}function addFullscreenControl(c){var b=L.control.fullscreen();if(c.mapfullscreencontrolposition!="default"){b.setPosition(c.mapfullscreencontrolposition)}b.addTo(c.lmap)}function addZoomControl(b){if(b.mapzoomcontrolposition!="default"){new L.Control.Zoom({position:b.mapzoomcontrolposition}).addTo(b.lmap)}else{new L.Control.Zoom().addTo(b.lmap)}}function addGeocoderControl(c){var b=null;if(c.mapgeocodercontrolposition!="default"){b=new L.mapbox.geocoderControl("mapbox.places",{autocomplete:c.mapgeocodercontrolautoc,position:c.mapgeocodercontrolposition,}).addTo(c.lmap)}else{b=new L.mapbox.geocoderControl("mapbox.places",{autocomplete:c.mapgeocodercontrolautoc,}).addTo(c.lmap)}b.on("select",function(d){c.mapcenter=new L.LatLng(d.feature.geometry.coordinates[1],d.feature.geometry.coordinates[0]);updateMarkersBoundsFromPosition(c,c.mapcenter,c.mapgeocoderradiuskm);updateMap(c,"geocoder")})}function addLegendControl(g,d,c){var b="";if(c=="base"){b="visible"}g.maplegendcontent='<div class="mapboxadv-legend-bloc mapboxadv-legend-'+c+"  "+b+'">'+d.html()+"</div>";var f=jQuery("#mapboxadv-legend-"+g.mapinternid);if(f.length==0){f=jQuery("<div>").attr("id","mapboxadv-legend-"+g.mapinternid).addClass("mapboxadv-legend").addClass(g.maplegendposition).html(g.maplegendcontent);var h=null;if(!g.mapstaticmap){if(g.maplegendposition!="default"){h=new L.mapbox.legendControl({position:g.maplegendposition,}).addTo(g.lmap)}else{h=new L.mapbox.legendControl({}).addTo(g.lmap)}h.addLegend(f.prop("outerHTML"))}else{f.addClass("staticmap").attr("style","display:block");var e=jQuery("#"+canvaspreffix+"-"+g.mapinternid);e.append(f)}}else{f.append(g.maplegendcontent)}}function addLocationMarker_mapboxicon(d){if(d.geolocationLatLng){var c=L.mapbox.marker.icon({"marker-size":d.maplocationmarkersize,"marker-symbol":d.maplocationmarkersymbol,"marker-color":d.maplocationmarkercolor,});L.marker([d.geolocationLatLng.lat,d.geolocationLatLng.lng],{icon:c}).addTo(d.lmap);if(d.mapcirclearoundlocation){var b=d.mapmaxradiuskm*1000;circlejson={};circlejson.type="Circle";circlejson.coordinates=[d.geolocationLatLng.lat,d.geolocationLatLng.lng];circlejson.radius=b;circlejson.properties={stroke:true,color:d.maplocationmarkercolor,fill:d.maplocationmarkercolor,weight:5};addCircle(d,circlejson)}}}function hasForceToFit(c,d){var b=false;switch(d){case"geocoder":if(c.mapgeocoderradiuskm>0){b=true}break;default:if((c.mapmaxradiuskm>0)&&(c.geolocationLatLng)&&(c.geolocationisinradius)){b=true}break}return b}function updateMap(c,e){if(typeof(e)==="undefined"){e="normal"}var b=hasForceToFit(c,e);if((!c.mapfittomarkers)&&(!b)){if((c.mapcenterlat!=0)&&(c.mapcenterlng!=0)){c.mapcenter=new L.LatLng(c.mapcenterlat,c.mapcenterlng)}if((c.geolocationLatLng)&&(c.geolocationisinradius)&&(c.mapcenteronlocation)){c.mapcenter=c.geolocationLatLng}zoomAndCenterMap(c)}else{fitMapToBounds(c,c.mapmarkersbounds)}if(c.mapstaticmap){var d=jQuery("#mapboxadv-legend-content-"+c.mapinternid+"-base");if(d.length){addLegendControl(c,d,"base")}}}function buildStaticUrl(e,d){if(typeof(d)==="undefined"){d=false}var b="";var c="";var f="";zoom=e.mapzoom;if(e.mapzoom==0){zoom=e.mapminzoom}if(d){f="auto"}else{if((e.mapcenterlat!=0)&&(e.mapcenterlng!=0)){f=e.mapcenter.lng+","+e.mapcenter.lat+","+zoom}}c=prepareStaticMapOverlays(e);b="http://api.tiles.mapbox.com/v4/"+e.mapboxid;if(c.length){b+="/"+c}if(f.length){b+="/"+f}b+="/"+e.pixelwidth+"x"+e.pixelheight+e.mapstaticmapretinasuffix+"."+e.mapstaticmapformat;b+="?access_token="+e.accesstoken;return b}function zoomAndCenterMap(c){if(c.mapstaticmap){var b=buildStaticUrl(c);jQuery("#"+canvaspreffix+"-"+c.mapinternid).empty().append("<img class='mapbox-static' id='mapbox-static"+c.mapinternid+"' src='"+b+"'/>")}else{if(c.mapzoom>0){c.lmap.setView(c.mapcenter,c.mapzoom)}else{c.lmap.setView(c.mapcenter)}c.lmap.invalidateSize(true)}}function fitMapToBounds(c,b){if(c.mapstaticmap){var f=buildStaticUrl(c,true);jQuery("#"+canvaspreffix+"-"+c.mapinternid).empty().append("<img class='mapbox-static' id='mapbox-static"+c.mapinternid+"' src='"+f+"'/>")}else{if((typeof(b)!=="undefined")&&(b!==null)&&(b.isValid())){var l=c.mappadding;if(jQuery.type(l)=="string"&&l.indexOf("%")!=-1){l=c.pixelwidth*(convertStrToInt(l)/100)}else{l=convertStrToInt(l)}var j=l;var g=l;var k=l;var h=l;var d=null;if(c.paddingtlx!==0){j=c.mappaddingtlx;if(jQuery.type(j)=="string"&&j.indexOf("%")!=-1){j=c.pixelwidth*(parseInt(j)/100)}else{j=convertStrToInt(j)}}if(c.paddingtly!==0){g=c.mappaddingtly;if(jQuery.type(g)=="string"&&g.indexOf("%")!=-1){g=c.pixelwidth*(parseInt(g)/100)}else{g=convertStrToInt(g)}}if(j!==0||g!==0){d=new L.Point(j,g)}var e=null;if(c.paddingbrx!==0){k=c.mappaddingbrx;if(jQuery.type(k)=="string"&&k.indexOf("%")!=-1){k=c.pixelwidth*(parseInt(k)/100)}else{k=convertStrToInt(k)}}if(c.paddingbry!==0){h=c.mappaddingbry;if(jQuery.type(h)=="string"&&h.indexOf("%")!=-1){h=c.pixelwidth*(parseInt(h)/100)}else{h=convertStrToInt(h)}}if(k!==0||h!==0){e=new L.Point(k,h)}if(d||e){c.lmap.fitBounds(b,{paddingTopLeft:d,paddingBottomRight:e})}else{c.lmap.fitBounds(b)}c.lmap.invalidateSize(true)}}}function updateMarkersBoundsFromPosition(g,d,c,f){if((typeof d==="undefined")||(d==null)){return false}if(typeof c==="undefined"){c=0}if(typeof f==="undefined"){f=true}if(c>0){for(i=g.markers.length-1;i>=0;i--){if(g.markers[i].getLatLng().distanceTo(d)>c*1000){g.markers[i].isinbounds=false}else{g.markers[i].isinbounds=true}}var b=[];jQuery.each(g.markers,function(j,h){if(h.isinbounds){b.push(h)}});if(b.length>0){var e=L.featureGroup(b);g.mapmarkersbounds=e.getBounds()}else{g.mapmarkersbounds=null}}if(g.mapmarkersbounds!==null){g.mapmarkersbounds.extend(d);minimize=true}else{g.mapmarkersbounds=new L.LatLngBounds(d,d);minimize=false}if(f){if(c>0){g.mapmarkersbounds=new L.LatLngBounds(dest(d.lat,d.lng,45,c));for(a=135;a<=315;a=a+45){g.mapmarkersbounds.extend(dest(d.lat,d.lng,a,c))}}}}function convertToJSON(b){b=b.replace(/&#91;/g,"[");b=b.replace(/&#93;/g,"]");return b}function convertStrToInt(b){return(parseInt(b)||0)}function convertStrToFloat(b){return(parseFloat(b)||0)}function convertStrToBool(b){return((b==="true")||(b==="1"))}function convertToSafeId(b){return b.replace(" ","-").trim()}if(typeof(Number.prototype.toRad)==="undefined"){Number.prototype.toRad=function(){return this*Math.PI/180}}if(typeof(Number.prototype.toDeg)==="undefined"){Number.prototype.toDeg=function(){return this*180/Math.PI}}function dest(g,b,c,j){this._radius=6371;j=typeof(j)=="number"?j:typeof(j)=="string"&&j.trim()!=""?+j:NaN;j=j/this._radius;c=c.toRad();var h=g.toRad(),e=b.toRad();var f=Math.asin(Math.sin(h)*Math.cos(j)+Math.cos(h)*Math.sin(j)*Math.cos(c));var d=e+Math.atan2(Math.sin(c)*Math.sin(j)*Math.cos(h),Math.cos(j)-Math.sin(h)*Math.sin(f));d=(d+3*Math.PI)%(2*Math.PI)-Math.PI;return new L.LatLng(f.toDeg(),d.toDeg())}function getBoundsZoomLevel(c,b){var j={height:256,width:256};var l=21;function e(r){var p=Math.sin(r*Math.PI/180);var q=Math.log((1+p)/(1-p))/2;return Math.max(Math.min(q,Math.PI),-Math.PI)/2}function o(r,q,p){return Math.floor(Math.log(r/q/p)/Math.LN2)}var f=b.getNorthEast();var n=b.getSouthWest();var g=(e(f.lat)-e(n.lat))/Math.PI;var k=f.lng-n.lng;var d=((k<0)?(k+360):k)/360;var h=o(c.pixelheight,j.height,g);var m=o(c.pixelwidth,j.width,d);return Math.min(h,m,l)}function getLocation(){}function prepareStaticMapOverlays(b){return""}function addLayers(b){}function addWMSLayers(b){}function addCircle(c,b){}function addCircles(b){}function addFeatures(b){}function addJSONToFeatureLayer(c,b){};